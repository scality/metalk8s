apiVersion: batch/v1
kind: Job
metadata:
  generateName: backup-cleanup-
  namespace: kube-system
  labels:
    app.kubernetes.io/name: backup-cleanup
    app.kubernetes.io/part-of: metalk8s
    app.kubernetes.io/managed-by: salt
spec:
  backoffLimit: 4
  parallelism: 1
  ttlSecondsAfterFinished: 86400
  template:
    metadata:
      labels:
        app.kubernetes.io/name: backup-cleanup
        app.kubernetes.io/part-of: metalk8s
        app.kubernetes.io/managed-by: salt
    spec:
      nodeName: {{ node }}
      containers:
      - name: backup-cleanup
        image: {{ image }}
        command:
            - rm
            - -f
            - {{ files }}
        volumeMounts:
        - name: backups
          mountPath: /backups
        workingDir: /backups
      restartPolicy: Never
      volumes:
        - name: backups
          hostPath:
            path: /var/lib/metalk8s/backups
            type: DirectoryOrCreate
